server {

	set $project_root "%hostdir%";
	listen         %ip%:%httpport%;
	listen         %ip%:%httpsport% ssl;
	server_name    %host% %aliases%;
	root           $project_root;
	index          index.php;
	location ~ /\. {deny all;}

	location /sitemap.xml {
		try_files $uri $uri/ /index2.php?controller=smap;
	}

	location / {
		root $project_root;
		index      index.php index.html index.htm;
		try_files $uri $uri/ /index.php$is_args$args;
	}

	location ~ \.php$ {
		try_files                          $uri = /404;
		fastcgi_pass                       backend;
		fastcgi_index                      index.php;
		fastcgi_param    CONTENT_TYPE      $content_type;
		fastcgi_param    CONTENT_LENGTH    $content_length;
		fastcgi_param    DOCUMENT_URI      $document_uri;
		fastcgi_param    DOCUMENT_ROOT     $document_root;
		fastcgi_param    GATEWAY_INTERFACE CGI/1.1;
		fastcgi_param    HTTPS             $https;
		fastcgi_param    QUERY_STRING      $query_string;
		fastcgi_param    REQUEST_METHOD    $request_method;
		fastcgi_param    REQUEST_URI       $request_uri;
		fastcgi_param    REMOTE_ADDR       $remote_addr;
		fastcgi_param    REMOTE_PORT       $remote_port;
		fastcgi_param    SERVER_ADDR       $server_addr;
		fastcgi_param    SERVER_PORT       $server_port;
		fastcgi_param    SERVER_NAME       $host;
		fastcgi_param    SERVER_PROTOCOL   $server_protocol;
		fastcgi_param    SERVER_SOFTWARE   nginx;
		fastcgi_param    SCRIPT_FILENAME   $document_root$fastcgi_script_name;
		fastcgi_param    SCRIPT_NAME       $fastcgi_script_name;
	}
}